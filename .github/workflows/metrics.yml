name: Metrics
on:
  push:
    branches: ["main"]
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.METRICS_TOKEN }}

      - name: Generate metrics
        uses: lowlighter/metrics@latest
        with:
          # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          token: ${{ secrets.METRICS_TOKEN }}
          user: Vu4eke
          template: classic
          base: header, activity, community, repositories, metadata
          config_timezone: Europe/Moscow
          config_order: isocalendar, languages, habits, lines, followers, achievements
          
          # –í–Ω–µ—à–Ω–∏–π –≤–∏–¥
          config_display: large
          config_padding: "0, 16, 8, 16"
          config_animations: true
          config_twemoji: true
          
          # –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          base_indepth: true
          repositories: 100
          repositories_forks: false
          repositories_affiliations: owner, collaborator
          
          # –ü–ª–∞–≥–∏–Ω: –ò–∑–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          plugin_isocalendar_style: classic
          
          # –ü–ª–∞–≥–∏–Ω: –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
          plugin_languages: yes
          plugin_languages_limit: 10
          plugin_languages_threshold: 0.5%
          plugin_languages_analysis_timeout: 30
          plugin_languages_categories: programming, markup, data
          plugin_languages_sections: most-used
          plugin_languages_colors: github
          plugin_languages_aliases: "css: CSS, html: HTML, jupyter notebook: Jupyter"
          
          # –ü–ª–∞–≥–∏–Ω: –ü—Ä–∏–≤—ã—á–∫–∏ –∫–æ–¥–∏–Ω–≥–∞
          plugin_habits: yes
          plugin_habits_days: 21
          plugin_habits_facts: yes
          plugin_habits_charts: yes
          plugin_habits_from: 500
          plugin_habits_trim: yes
          
          # –ü–ª–∞–≥–∏–Ω: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞
          plugin_lines: yes
          plugin_lines_history_limit: 3
          plugin_lines_repositories_limit: 20
          plugin_lines_categories: code, blanks, comments
          plugin_lines_sections: repositories, categories, history
          
          # –ü–ª–∞–≥–∏–Ω: –ü–æ–¥–ø–∏—Å—á–∏–∫–∏
          plugin_followers: yes
          plugin_followers_limit: 24
          plugin_followers_avatars: yes
          
          # –ü–ª–∞–≥–∏–Ω: –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
          plugin_achievements: yes
          plugin_achievements_secrets: yes
          plugin_achievements_display: detailed
          plugin_achievements_limit: 0
          plugin_achievements_threshold: C
          
          # –ü–ª–∞–≥–∏–Ω: –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
          plugin_activity: no
          plugin_activity_limit: 10
          plugin_activity_days: 14
          plugin_activity_filter: all
          plugin_activity_visibility: all
          
          # –ü–ª–∞–≥–∏–Ω: –¢–æ–ø –∫–æ–Ω—Ç—Ä–∏–±—É—Ü–∏–π
          plugin_topics: yes
          plugin_topics_limit: 16
          plugin_topics_mode: starred
          plugin_topics_sort: stars
          
          # –ü–ª–∞–≥–∏–Ω: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
          plugin_repositories: yes
          plugin_repositories_limit: 12
          plugin_repositories_features: stars, forks, languages
          plugin_repositories_languages: yes
          plugin_repositories_pinned: 6
          
          # –ü–ª–∞–≥–∏–Ω: Gists
          plugin_gists: yes
          plugin_gists_limit: 8
          
          # –ü–ª–∞–≥–∏–Ω: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–º–∏—Ç–æ–≤
          plugin_commits: yes
          plugin_commits_limit: 20
          plugin_commits_auto: yes
          plugin_commits_latest: yes

          # –ü–ª–∞–≥–∏–Ω: WakaTime
          plugin_wakatime: yes
          plugin_wakatime_token: ${{ secrets.WAKA_TOKEN }}
          plugin_wakatime_sections: time, projects, languages, languages_graph, editors, os
          plugin_wakatime_days: 365

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git commit -m "üìä Update metrics - $(date)" || exit 0
          git push
